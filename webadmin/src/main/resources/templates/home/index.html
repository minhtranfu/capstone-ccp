<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>

    <div th:replace="fragments/header :: header"></div>
    <title>CCP Admin</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>
</head>

<body>

<div id="wrapper">

    <!-- Navigation -->
    <div th:replace="fragments/navigation :: navigation"></div>

    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Dashboard</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-user fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge"><p th:text="${newContractor}"></p></div>
                                <div>New Contractor</div>
                            </div>
                        </div>
                    </div>
                    <a th:href="@{/contractor/index}">
                        <div class="panel-footer">
                            <span class="pull-left">View Details</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>

                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="panel panel-green">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-tasks fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge"><p th:text="${newFeedback}"></p></div>
                                <div>New Report</div>
                            </div>
                        </div>
                    </div>
                    <a th:href="@{/report/index}">
                        <div class="panel-footer">
                            <span class="pull-left">View Details</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="panel panel-yellow">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-shopping-cart fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">124</div>
                                <div>New Orders!</div>
                            </div>
                        </div>
                    </div>
                    <a href="#">
                        <div class="panel-footer">
                            <span class="pull-left">View Details</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="panel panel-red">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-support fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">13</div>
                                <div>Support Tickets!</div>
                            </div>
                        </div>
                    </div>
                    <a href="#">
                        <div class="panel-footer">
                            <span class="pull-left">View Details</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-bar-chart-o fa-fw"></i> Equipment

                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-4"></div>
                            <div class="col-lg-4">
                                <input type="text" name="daterange" class="form-control"/>
                            </div>
                            <div class="col-lg-4">
                                <select name="selectType" class="form-control">
                                    <option value="apple">Year</option>
                                    <option value="banana">Month</option>
                                    <option value="orange">Week</option>
                                </select>
                            </div>
                        </div>
                        <div id="chart3"></div>
                        <div id="columnchart_hiring_transaction" style="width: 500px; height: 500px;"></div>
                        <div id="columnchart_equipment" style="width: 500px; height: 500px;"></div>
                        <script type="text/javascript" th:inline="javascript">
                            var reports = /*[[${reports}]]*/ 'reports';
                            var reports2 = /*[[${reports2}]]*/ 'reports2';


                            google.charts.load('current', {'packages': ['corechart', 'bar', 'line']});
                            google.charts.setOnLoadCallback(drawChart);

                            function drawChart() {
                                var reportsData = [
                                    ['Type', 'Quantity']
                                ];
                                Object.keys(reports).forEach(function (key) {
                                    var value = reports[key];
                                    reportsData.push([key.charAt(0).toUpperCase() + key.substr(1, key.length), value]);
                                });

                                var data = google.visualization.arrayToDataTable(reportsData);

                                var options = {
                                    title: 'Report',
                                    width: 500,
                                    chart: {
                                        title: 'ABC',
                                        subtitle: 'Equipment and Material'
                                    },
                                    bars: 'vertical', // Required for Material Bar Charts.
                                    series: {
                                        0: {axis: 'equipment'}, // Bind series 0 to an axis named 'distance'.
                                        1: {axis: 'material'} // Bind series 1 to an axis named 'brightness'.
                                    },
                                    axes: {
                                        x: {
                                            0: {side: 'top', label: 'equipment'}, // Top x-axis.
                                            1: {side: 'top', label: 'material'} // Top x-axis.
                                        }
                                    },
                                    bar: {groupWidth: "50%"}
                                };


                                var chart = new google.charts.Bar(document.getElementById('columnchart_equipment'));

                                chart.draw(data, google.charts.Bar.convertOptions(options));
                            }

                            function drawMultipleChart() {


                                var reportsData = [
                                    ['Year', 'Total', 'Processing', 'Finished', 'Canceled']
                                ];
                                Object.keys(reports2).forEach(function (key) {

                                    var subKey = reports2[key];

                                    reportsData.push([key.charAt(0).toUpperCase() + key.substr(1, key.length), value]);
                                });

                                var data = google.visualization.arrayToDataTable(reportsData);
                                var data = google.visualization.arrayToDataTable([
                                    ['Year', 'Sales', 'Expenses', 'Profit'],
                                    ['2014', 1000, 400, 200],
                                    ['2015', 1170, 460, 250],
                                    ['2016', 660, 1120, 300],
                                    ['2017', 1030, 540, 350]
                                ]);

                                var options = {
                                    chart: {
                                        title: 'Company Performance',
                                        subtitle: 'Sales, Expenses, and Profit: 2014-2017',
                                    },
                                    bars: 'vertical' // Required for Material Bar Charts.
                                };

                                var chart = new google.charts.Bar(document.getElementById('columnchart_hiring_transaction'));

                                chart.draw(data, google.charts.Bar.convertOptions(options));
                            }
                        </script>
                    </div>
                    <!-- /.panel-body -->
                </div>

            </div>
            <!-- /.col-lg-12 -->

        </div>
        <!-- /.row -->
    </div>
    <!-- /#page-wrapper -->

</div>
<!-- /#wrapper -->

<div th:replace="fragments/footer_javascript :: footer_javascript"></div>
<script>
    $(document).ready(function () {

        $(function () {
            $('input[name="daterange"]').daterangepicker({
                startDate: moment().subtract(1, 'months'),
                endDate: moment(),
                opens: 'left',
                locale: {
                    format: 'DD/MM/YYYY'
                }
            }, callAnalyst);
        });
        function callAnalyst(start, end) {
            $.ajax({
                url: "/report/equipment",
                type: "GET", //send it through get method
                data: {
                    beginDate: start.format('DD-MM-YYYY'),
                    endDate: end.format('DD-MM-YYYY')
                },
                success: function (response) {
                    console.log(response);
                    reports = response;
                    drawChart();
                },
                error: function (xhr) {
                    //Do Something to handle error
                }
            });
            $.ajax({
                url: "/report/hiringTransacton",
                type: "GET",
                data: {
                    beginDate: start.format('DD-MM-YYYY'),
                    endDate: end.format('DD-MM-YYYY')
                },
                success: function (response) {
                    console.log(response);
                    reports = response;
                    drawMultipleChart();
                },
                error: function (xhr) {
                    //Do Something to handle error
                }
            });
        }
    })
</script>

</body>

</html>
